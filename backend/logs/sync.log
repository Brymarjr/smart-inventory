[2025-11-04 10:18:28,435] INFO sync: [SYNC] POST /api/sync/devices/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=201 duration=0.13s
[2025-11-04 10:26:43,277] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=N/A ip=127.0.0.1 status=500 duration=0.20s
[2025-11-14 20:18:52,110] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=1.07s
[2025-11-14 20:18:53,034] WARNING sync.tasks: Sync: model Category not enabled for tenant 7
[2025-11-14 20:18:53,061] INFO sync.tasks: Processed SyncJob 1: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 1, 'error': 'Model Category not sync-enabled'}]}
[2025-11-14 20:19:40,286] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.06s
[2025-11-14 20:33:30,422] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.80s
[2025-11-14 20:33:30,807] WARNING sync.tasks: Sync: model Category not enabled for tenant 7
[2025-11-14 20:33:30,884] INFO sync.tasks: Processed SyncJob 2: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 2, 'error': 'Model Category not sync-enabled'}]}
[2025-11-14 20:34:44,819] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-11-14 20:43:40,467] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.63s
[2025-11-14 20:43:40,956] WARNING sync.tasks: Sync: model Category not enabled for tenant 7
[2025-11-14 20:43:41,057] INFO sync.tasks: Processed SyncJob 3: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 3, 'error': 'Model Category not sync-enabled'}]}
[2025-11-14 20:43:55,499] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.10s
[2025-11-14 21:20:40,276] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.30s
[2025-11-14 21:20:40,492] WARNING sync.tasks: Sync: model Category not enabled for tenant 7
[2025-11-14 21:20:40,509] INFO sync.tasks: Processed SyncJob 4: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 4, 'error': 'Model Category not sync-enabled'}]}
[2025-11-14 21:20:54,311] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.03s
[2025-11-14 21:22:22,167] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.06s
[2025-11-14 21:22:22,302] ERROR sync.tasks: Sync: failed to resolve model Category: not enough values to unpack (expected 2, got 1)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 95, in _apply_sync_operation
    Model = apps.get_model(model_path)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/apps/registry.py", line 206, in get_model
    app_label, model_name = app_label.split(".")
    ^^^^^^^^^^^^^^^^^^^^^
ValueError: not enough values to unpack (expected 2, got 1)
[2025-11-14 21:22:22,322] INFO sync.tasks: Processed SyncJob 5: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 5, 'error': 'Model resolution failed: not enough values to unpack (expected 2, got 1)'}]}
[2025-11-14 21:22:31,635] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.03s
[2025-11-14 22:06:14,517] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.43s
[2025-11-14 22:06:14,726] ERROR sync.tasks: Exception while applying sync operation (job=6 op=6): 'str' object has no attribute 'setdefault'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 121, in _apply_sync_operation
    payload.setdefault("tenant_id", tenant.id)
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'setdefault'
[2025-11-14 22:06:14,755] INFO sync.tasks: Processed SyncJob 6: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 6, 'error': "'str' object has no attribute 'setdefault'"}]}
[2025-11-14 22:06:24,685] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.07s
[2025-11-15 07:54:18,829] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.25s
[2025-11-15 07:54:19,033] INFO sync.tasks: Sync CREATE: tenant=7 model=inventory.Category id=2 job=7 op=7
[2025-11-15 07:54:19,047] INFO sync.tasks: Processed SyncJob 7: {'processed': 1, 'succeeded': 1, 'failed': 0, 'conflicts': 0, 'errors': []}
[2025-11-15 07:54:39,446] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.06s
[2025-11-15 08:06:09,414] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.07s
[2025-11-15 08:06:09,541] INFO sync.tasks: Sync CREATE: tenant=7 model=inventory.Category id=3 job=8 op=8
[2025-11-15 08:06:09,553] INFO sync.tasks: Processed SyncJob 8: {'processed': 1, 'succeeded': 1, 'failed': 0, 'conflicts': 0, 'errors': []}
[2025-11-15 08:07:29,654] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.08s
[2025-11-15 08:07:29,743] WARNING sync.tasks: Sync UPDATE missing pk: job=9 op=9 model=inventory.Category
[2025-11-15 08:07:29,769] INFO sync.tasks: Processed SyncJob 9: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 9, 'error': "Update payload missing primary key ('id' or 'pk')."}]}
[2025-11-15 08:07:44,579] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.06s
[2025-11-15 08:08:35,727] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.06s
[2025-11-15 08:08:35,811] WARNING sync.tasks: Sync UPDATE missing pk: job=10 op=10 model=inventory.Category
[2025-11-15 08:08:35,849] INFO sync.tasks: Processed SyncJob 10: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 10, 'error': "Update payload missing primary key ('id' or 'pk')."}]}
[2025-11-15 08:08:44,637] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.05s
[2025-11-15 08:12:34,195] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.05s
[2025-11-15 08:12:34,337] INFO sync.tasks: Processed SyncJob 11: {'processed': 1, 'succeeded': 1, 'failed': 0, 'conflicts': 0, 'errors': []}
[2025-11-15 08:12:42,322] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.07s
[2025-11-15 08:15:47,389] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.08s
[2025-11-15 08:15:47,521] INFO sync.tasks: Sync DELETE: tenant=7 model=inventory.Category pk=2 job=12 op=12
[2025-11-15 08:15:47,546] INFO sync.tasks: Processed SyncJob 12: {'processed': 1, 'succeeded': 1, 'failed': 0, 'conflicts': 0, 'errors': []}
[2025-11-15 08:15:55,455] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.05s
[2025-11-15 08:17:31,080] INFO sync: [SYNC] GET /api/sync/download/ by 'Admin' device=N/A ip=127.0.0.1 status=400 duration=0.02s
[2025-11-15 08:19:46,514] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.08s
[2025-11-15 08:19:46,649] INFO sync.tasks: Sync CREATE: tenant=7 model=inventory.Category id=4 job=13 op=13
[2025-11-15 08:19:46,715] INFO sync.tasks: Sync DELETE: tenant=7 model=inventory.Category pk=3 job=13 op=15
[2025-11-15 08:19:46,733] INFO sync.tasks: Processed SyncJob 13: {'processed': 3, 'succeeded': 3, 'failed': 0, 'conflicts': 0, 'errors': []}
[2025-11-15 08:19:57,677] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.03s
[2025-11-15 08:26:10,697] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.13s
[2025-11-15 08:26:10,830] INFO sync.tasks: Sync CREATE: tenant=7 model=inventory.Category id=5 job=14 op=16
[2025-11-15 08:26:10,866] INFO sync.tasks: Sync CREATE: tenant=7 model=inventory.Product id=2 job=14 op=17
[2025-11-15 08:26:10,886] ERROR sync.tasks: Exception while applying sync operation (job=14 op=18): PurchaseOrder() got unexpected keyword arguments: 'product_id', 'quantity', 'total_cost'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 173, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 569, in __init__
    raise TypeError(
TypeError: PurchaseOrder() got unexpected keyword arguments: 'product_id', 'quantity', 'total_cost'
[2025-11-15 08:26:10,927] ERROR sync.tasks: Exception while applying sync operation (job=14 op=19): Sale() got unexpected keyword arguments: 'product_id', 'quantity'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 173, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 569, in __init__
    raise TypeError(
TypeError: Sale() got unexpected keyword arguments: 'product_id', 'quantity'
[2025-11-15 08:26:10,946] INFO sync.tasks: Processed SyncJob 14: {'processed': 4, 'succeeded': 2, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 18, 'error': "PurchaseOrder() got unexpected keyword arguments: 'product_id', 'quantity', 'total_cost'"}, {'op_id': 19, 'error': "Sale() got unexpected keyword arguments: 'product_id', 'quantity'"}]}
[2025-11-15 08:26:18,257] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.06s
[2025-11-15 09:28:04,749] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.84s
[2025-11-15 09:28:05,067] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=1 job=15 op=20
[2025-11-15 09:28:05,089] WARNING sync.tasks: Sync: model PurchaseItem is not in SYNC_MODELS for tenant 7
[2025-11-15 09:28:05,134] INFO sync.tasks: Sync CREATE: tenant=7 model=sales.Sale id=2 job=15 op=22
[2025-11-15 09:28:05,162] WARNING sync.tasks: Sync: model SaleItem is not in SYNC_MODELS for tenant 7
[2025-11-15 09:28:05,181] INFO sync.tasks: Processed SyncJob 15: {'processed': 4, 'succeeded': 2, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 21, 'error': 'Model PurchaseItem not sync-enabled'}, {'op_id': 23, 'error': 'Model SaleItem not sync-enabled'}]}
[2025-11-15 09:28:12,970] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.07s
[2025-11-15 09:30:20,651] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.42s
[2025-11-15 09:30:20,921] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=2 job=16 op=24
[2025-11-15 09:30:20,936] WARNING sync.tasks: Sync: model PurchaseItem is not in SYNC_MODELS for tenant 7
[2025-11-15 09:30:20,949] ERROR sync.tasks: Sync: failed to resolve model purchases.PurchaseItemsales.Sale: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 147, in _apply_sync_operation
    Model = apps.get_model(model_path)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/apps/registry.py", line 206, in get_model
    app_label, model_name = app_label.split(".")
    ^^^^^^^^^^^^^^^^^^^^^
ValueError: too many values to unpack (expected 2)
[2025-11-15 09:30:21,006] ERROR sync.tasks: Exception while applying sync operation (job=16 op=27): null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (2, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (2, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (2, 4, 1500.00, 6000.00, 2, null).

[2025-11-15 09:30:21,064] ERROR sync.tasks: Error processing sync op 27: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (2, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (2, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 09:30:21,085] INFO sync.tasks: Processed SyncJob 16: {'processed': 4, 'succeeded': 1, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 25, 'error': 'Model PurchaseItem not sync-enabled'}, {'op_id': 26, 'error': 'Model resolution failed: too many values to unpack (expected 2)'}, {'op_id': 27, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-11-15 09:30:28,065] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.07s
[2025-11-15 09:31:31,831] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.28s
[2025-11-15 09:31:32,120] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=3 job=17 op=28
[2025-11-15 09:31:32,147] ERROR sync.tasks: Exception while applying sync operation (job=17 op=29): null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (1, 10, 1500.00, 15000.00, 2, null, 1500.00).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (1, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (1, 10, 1500.00, 15000.00, 2, null, 1500.00).

[2025-11-15 09:31:32,187] ERROR sync.tasks: Error processing sync op 29: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (1, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (1, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 09:31:32,220] ERROR sync.tasks: Exception while applying sync operation (job=17 op=30): duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.

[2025-11-15 09:31:32,237] ERROR sync.tasks: Error processing sync op 30: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 09:31:32,266] ERROR sync.tasks: Exception while applying sync operation (job=17 op=31): null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (3, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (3, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (3, 4, 1500.00, 6000.00, 2, null).

[2025-11-15 09:31:32,325] ERROR sync.tasks: Error processing sync op 31: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (3, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (3, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 09:31:32,357] INFO sync.tasks: Processed SyncJob 17: {'processed': 4, 'succeeded': 1, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 29, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 30, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 31, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-11-15 09:31:39,171] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-11-15 10:10:54,605] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.40s
[2025-11-15 10:10:54,835] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=4 job=18 op=32
[2025-11-15 10:10:54,852] ERROR sync.tasks: Exception while applying sync operation (job=18 op=33): null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (2, 10, 1500.00, 15000.00, 2, null, 1500.00).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (2, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    try:
         
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (2, 10, 1500.00, 15000.00, 2, null, 1500.00).

[2025-11-15 10:10:54,879] ERROR sync.tasks: Error processing sync op 33: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (2, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    try:
         
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (2, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 10:10:54,893] ERROR sync.tasks: Exception while applying sync operation (job=18 op=34): duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    try:
         
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.

[2025-11-15 10:10:54,919] ERROR sync.tasks: Error processing sync op 34: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    try:
         
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 10:10:54,941] ERROR sync.tasks: Exception while applying sync operation (job=18 op=35): null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (4, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (4, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    try:
         
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (4, 4, 1500.00, 6000.00, 2, null).

[2025-11-15 10:10:55,029] ERROR sync.tasks: Error processing sync op 35: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (4, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 178, in _apply_sync_operation
    try:
         
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (4, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 10:10:55,060] INFO sync.tasks: Processed SyncJob 18: {'processed': 4, 'succeeded': 1, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 33, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 34, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 35, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-11-15 10:11:03,623] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-11-15 10:11:32,369] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.04s
[2025-11-15 10:11:32,523] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=5 job=19 op=36
[2025-11-15 10:11:32,555] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseItem id=3 job=19 op=37
[2025-11-15 10:11:32,574] ERROR sync.tasks: Sync CREATE failed: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 156, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.

[2025-11-15 10:11:32,601] ERROR sync.tasks: Error processing sync op 38: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 156, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 10:11:32,616] ERROR sync.tasks: Sync CREATE failed: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (5, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (5, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 156, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (5, 4, 1500.00, 6000.00, 2, null).

[2025-11-15 10:11:32,635] ERROR sync.tasks: Error processing sync op 39: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (5, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 156, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (5, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-15 10:11:32,659] INFO sync.tasks: Processed SyncJob 19: {'processed': 4, 'succeeded': 2, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 38, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 39, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-11-15 10:11:38,857] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.06s
[2025-11-15 11:34:58,426] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.30s
[2025-11-15 11:34:58,657] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=6 job=20 op=40
[2025-11-15 11:34:58,676] ERROR sync.tasks: Exception while applying sync operation (job=20 op=41): null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (4, 10, 1500.00, 15000.00, 2, null, 1500.00).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (4, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (4, 10, 1500.00, 15000.00, 2, null, 1500.00).

[2025-11-15 11:34:58,720] ERROR sync.tasks: Exception while applying sync operation (job=20 op=42): duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0001) already exists.

[2025-11-15 11:34:58,743] ERROR sync.tasks: Exception while applying sync operation (job=20 op=43): null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (6, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (6, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (6, 4, 1500.00, 6000.00, 2, null).

[2025-11-15 11:34:58,814] INFO sync.tasks: Sync DELETE: already deleted (tenant=7 model=sales.SaleItem pk=2)
[2025-11-15 11:34:58,831] INFO sync.tasks: Processed SyncJob 20: {'processed': 6, 'succeeded': 3, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 41, 'error': 'null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint\nDETAIL:  Failing row contains (4, 10, 1500.00, 15000.00, 2, null, 1500.00).\n'}, {'op_id': 42, 'error': 'duplicate key value violates unique constraint "sales_sale_reference_key"\nDETAIL:  Key (reference)=(SALE-0001) already exists.\n'}, {'op_id': 43, 'error': 'null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint\nDETAIL:  Failing row contains (6, 4, 1500.00, 6000.00, 2, null).\n'}]}
[2025-11-15 11:35:05,241] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.09s
[2025-11-15 11:40:23,783] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.08s
[2025-11-15 11:40:23,967] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=7 job=21 op=46
[2025-11-15 11:40:23,984] ERROR sync.tasks: Exception while applying sync operation (job=21 op=47): null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (5, 10, 1500.00, 15000.00, 2, null, 1500.00).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (5, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (5, 10, 1500.00, 15000.00, 2, null, 1500.00).

[2025-11-15 11:40:24,016] INFO sync.tasks: Sync CREATE: tenant=7 model=sales.Sale id=7 job=21 op=48
[2025-11-15 11:40:24,041] ERROR sync.tasks: Exception while applying sync operation (job=21 op=49): null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (7, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (7, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (7, 4, 1500.00, 6000.00, 2, null).

[2025-11-15 11:40:24,110] ERROR sync.tasks: Exception while applying sync operation (job=21 op=51): Field 'id' expected a number but got 'tmp_sale_item_002'.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/fields/__init__.py", line 2128, in get_prep_value
    return int(value)
           ^^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'tmp_sale_item_002'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 272, in _apply_sync_operation
    obj = qs.get(pk=pk)
          ^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 619, in get
    clone = self._chain() if self.query.combinator else self.filter(*args, **kwargs)
                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1493, in filter
    return self._filter_or_exclude(False, args, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1511, in _filter_or_exclude
    clone._filter_or_exclude_inplace(negate, args, kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1518, in _filter_or_exclude_inplace
    self._query.add_q(Q(*args, **kwargs))
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/query.py", line 1646, in add_q
    clause, _ = self._add_q(q_object, can_reuse)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/query.py", line 1678, in _add_q
    child_clause, needed_inner = self.build_filter(
                                 ^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/query.py", line 1588, in build_filter
    condition = self.build_lookup(lookups, col, value)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/query.py", line 1415, in build_lookup
    lookup = lookup_class(lhs, rhs)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/lookups.py", line 38, in __init__
    self.rhs = self.get_prep_lookup()
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/lookups.py", line 410, in get_prep_lookup
    return super().get_prep_lookup()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/lookups.py", line 96, in get_prep_lookup
    return self.lhs.output_field.get_prep_value(self.rhs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/fields/__init__.py", line 2130, in get_prep_value
    raise e.__class__(
ValueError: Field 'id' expected a number but got 'tmp_sale_item_002'.
[2025-11-15 11:40:24,156] INFO sync.tasks: Processed SyncJob 21: {'processed': 6, 'succeeded': 3, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 47, 'error': 'null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint\nDETAIL:  Failing row contains (5, 10, 1500.00, 15000.00, 2, null, 1500.00).\n'}, {'op_id': 49, 'error': 'null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint\nDETAIL:  Failing row contains (7, 4, 1500.00, 6000.00, 2, null).\n'}, {'op_id': 51, 'error': "Field 'id' expected a number but got 'tmp_sale_item_002'."}]}
[2025-11-15 11:40:32,550] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-11-15 11:40:33,607] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.12s
[2025-11-15 23:50:03,945] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.37s
[2025-11-15 23:50:04,143] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=8 job=22 op=52
[2025-11-15 23:50:04,171] ERROR sync.tasks: Exception while applying sync operation (job=22 op=53): null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (6, 10, 1500.00, 15000.00, 2, null, 1500.00).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (6, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (6, 10, 1500.00, 15000.00, 2, null, 1500.00).

[2025-11-15 23:50:04,225] INFO sync.tasks: Sync CREATE: tenant=7 model=sales.Sale id=8 job=22 op=54
[2025-11-15 23:50:04,251] ERROR sync.tasks: Exception while applying sync operation (job=22 op=55): null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (8, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (8, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (8, 4, 1500.00, 6000.00, 2, null).

[2025-11-15 23:50:04,273] INFO sync.tasks: Processed SyncJob 22: {'processed': 4, 'succeeded': 2, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 53, 'error': 'null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint\nDETAIL:  Failing row contains (6, 10, 1500.00, 15000.00, 2, null, 1500.00).\n'}, {'op_id': 55, 'error': 'null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint\nDETAIL:  Failing row contains (8, 4, 1500.00, 6000.00, 2, null).\n'}]}
[2025-11-15 23:50:15,900] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.10s
[2025-11-15 23:51:20,431] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.11s
[2025-11-15 23:51:20,604] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=9 job=23 op=56
[2025-11-15 23:51:20,629] ERROR sync.tasks: Exception while applying sync operation (job=23 op=57): null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (7, 10, 1500.00, 15000.00, 2, null, 1500.00).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (7, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (7, 10, 1500.00, 15000.00, 2, null, 1500.00).

[2025-11-15 23:51:20,678] ERROR sync.tasks: Exception while applying sync operation (job=23 op=58): duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0100) already exists.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0100) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: duplicate key value violates unique constraint "sales_sale_reference_key"
DETAIL:  Key (reference)=(SALE-0100) already exists.

[2025-11-15 23:51:20,698] ERROR sync.tasks: Exception while applying sync operation (job=23 op=59): null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (9, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (9, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (9, 4, 1500.00, 6000.00, 2, null).

[2025-11-15 23:51:20,734] INFO sync.tasks: Processed SyncJob 23: {'processed': 4, 'succeeded': 1, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 57, 'error': 'null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint\nDETAIL:  Failing row contains (7, 10, 1500.00, 15000.00, 2, null, 1500.00).\n'}, {'op_id': 58, 'error': 'duplicate key value violates unique constraint "sales_sale_reference_key"\nDETAIL:  Key (reference)=(SALE-0100) already exists.\n'}, {'op_id': 59, 'error': 'null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint\nDETAIL:  Failing row contains (9, 4, 1500.00, 6000.00, 2, null).\n'}]}
[2025-11-15 23:51:26,951] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.07s
[2025-11-15 23:57:16,106] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=N/A ip=127.0.0.1 status=400 duration=0.03s
[2025-11-15 23:59:55,622] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=2 ip=127.0.0.1 status=400 duration=0.02s
[2025-11-16 00:00:08,186] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.16s
[2025-11-16 00:02:46,548] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=2 ip=127.0.0.1 status=202 duration=0.16s
[2025-11-16 00:02:46,823] INFO sync.tasks: Sync CREATE: tenant=7 model=purchases.PurchaseOrder id=10 job=24 op=60
[2025-11-16 00:02:46,844] ERROR sync.tasks: Exception while applying sync operation (job=24 op=61): PurchaseItem() got unexpected keyword arguments: 'purchase_id_from_client_change'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 569, in __init__
    raise TypeError(
TypeError: PurchaseItem() got unexpected keyword arguments: 'purchase_id_from_client_change'
[2025-11-16 00:02:46,886] INFO sync.tasks: Sync CREATE: tenant=7 model=sales.Sale id=10 job=24 op=62
[2025-11-16 00:02:46,897] ERROR sync.tasks: Exception while applying sync operation (job=24 op=63): SaleItem() got unexpected keyword arguments: 'sale_id_from_client_change'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 179, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 569, in __init__
    raise TypeError(
TypeError: SaleItem() got unexpected keyword arguments: 'sale_id_from_client_change'
[2025-11-16 00:02:46,924] INFO sync.tasks: Processed SyncJob 24: {'processed': 4, 'succeeded': 2, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 61, 'error': "PurchaseItem() got unexpected keyword arguments: 'purchase_id_from_client_change'"}, {'op_id': 63, 'error': "SaleItem() got unexpected keyword arguments: 'sale_id_from_client_change'"}]}
[2025-11-16 00:02:54,686] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.08s
[2025-11-16 00:16:27,996] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=3 ip=127.0.0.1 status=202 duration=0.09s
[2025-11-16 00:16:28,163] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseOrder id=12 job=25 op=64
[2025-11-16 00:16:28,193] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseItem id=9 job=25 op=65
[2025-11-16 00:16:28,227] INFO sync.tasks: Sync CREATE: tenant=9 model=sales.Sale id=13 job=25 op=66
[2025-11-16 00:16:28,258] INFO sync.tasks: Sync CREATE: tenant=9 model=sales.SaleItem id=11 job=25 op=67
[2025-11-16 00:16:28,276] INFO sync.tasks: Processed SyncJob 25: {'processed': 4, 'succeeded': 4, 'failed': 0, 'conflicts': 0, 'errors': []}
[2025-11-16 00:16:39,080] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-11-16 17:36:37,468] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.28s
[2025-11-16 17:36:37,652] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseOrder id=13 job=26 op=68
[2025-11-16 17:36:37,664] ERROR sync.tasks: Exception while applying sync operation (job=26 op=69): PurchaseItem() got unexpected keyword arguments: 'purchase_tmp_id'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 187, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 569, in __init__
    raise TypeError(
TypeError: PurchaseItem() got unexpected keyword arguments: 'purchase_tmp_id'
[2025-11-16 17:36:37,726] INFO sync.tasks: Sync CREATE: tenant=9 model=sales.Sale id=14 job=26 op=70
[2025-11-16 17:36:37,742] ERROR sync.tasks: Exception while applying sync operation (job=26 op=71): SaleItem() got unexpected keyword arguments: 'sale_tmp_id'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 187, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 569, in __init__
    raise TypeError(
TypeError: SaleItem() got unexpected keyword arguments: 'sale_tmp_id'
[2025-11-16 17:36:37,773] INFO sync.tasks: Processed SyncJob 26: {'processed': 4, 'succeeded': 2, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 69, 'error': "PurchaseItem() got unexpected keyword arguments: 'purchase_tmp_id'"}, {'op_id': 71, 'error': "SaleItem() got unexpected keyword arguments: 'sale_tmp_id'"}]}
[2025-11-16 17:36:46,715] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-11-16 18:27:30,523] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.07s
[2025-11-16 18:27:30,808] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseOrder id=14 job=27 op=72
[2025-11-16 18:27:30,838] ERROR sync.tasks: DB IntegrityError applying op 73 (job=27): null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (10, 10, 1500.00, 15000.00, 2, null, 1500.00).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (10, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 187, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (10, 10, 1500.00, 15000.00, 2, null, 1500.00).

[2025-11-16 18:27:30,875] ERROR sync.tasks: Error processing sync op 73: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (10, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 187, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/purchases/models.py", line 94, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "purchase_id" of relation "purchases_purchaseitem" violates not-null constraint
DETAIL:  Failing row contains (10, 10, 1500.00, 15000.00, 2, null, 1500.00).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-16 18:27:30,916] INFO sync.tasks: Sync CREATE: tenant=9 model=sales.Sale id=15 job=27 op=74
[2025-11-16 18:27:30,961] ERROR sync.tasks: DB IntegrityError applying op 75 (job=27): null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (12, 4, 1500.00, 6000.00, 2, null).
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (12, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 187, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (12, 4, 1500.00, 6000.00, 2, null).

[2025-11-16 18:27:31,016] ERROR sync.tasks: Error processing sync op 75: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (12, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 187, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/sales/models.py", line 40, in save
    super().save(*args, **kwargs)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "sale_id" of relation "sales_saleitem" violates not-null constraint
DETAIL:  Failing row contains (12, 4, 1500.00, 6000.00, 2, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-16 18:27:31,049] INFO sync.tasks: Processed SyncJob 27: {'processed': 4, 'succeeded': 2, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 73, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 75, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-11-16 18:27:44,404] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.09s
[2025-11-19 20:46:18,859] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.66s
[2025-11-19 20:46:19,345] WARNING sync.tasks: Sync preflight failed (op=76 job=28): Missing required FK fields for purchases.PurchaseOrder: tenant_id
[2025-11-19 20:46:19,372] WARNING sync.tasks: Sync preflight failed (op=77 job=28): Missing required FK fields for purchases.PurchaseItem: purchase_id
[2025-11-19 20:46:19,394] WARNING sync.tasks: Sync preflight failed (op=78 job=28): Missing required FK fields for sales.Sale: tenant_id
[2025-11-19 20:46:19,429] WARNING sync.tasks: Sync preflight failed (op=79 job=28): Missing required FK fields for sales.SaleItem: sale_id
[2025-11-19 20:46:19,498] INFO sync.tasks: Processed SyncJob 28: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 76, 'error': 'Missing required FK fields for purchases.PurchaseOrder: tenant_id'}, {'op_id': 77, 'error': 'Missing required FK fields for purchases.PurchaseItem: purchase_id'}, {'op_id': 78, 'error': 'Missing required FK fields for sales.Sale: tenant_id'}, {'op_id': 79, 'error': 'Missing required FK fields for sales.SaleItem: sale_id'}]}
[2025-11-19 20:46:26,580] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.09s
[2025-11-19 21:04:23,956] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.62s
[2025-11-19 21:04:24,281] WARNING sync.tasks: Sync preflight failed (op=80 job=29): Missing required FK fields for purchases.PurchaseOrder: tenant_id
[2025-11-19 21:04:24,298] WARNING sync.tasks: Sync preflight failed (op=81 job=29): Missing required FK fields for purchases.PurchaseItem: purchase_id
[2025-11-19 21:04:24,363] WARNING sync.tasks: Sync preflight failed (op=82 job=29): Missing required FK fields for sales.Sale: tenant_id
[2025-11-19 21:04:24,382] WARNING sync.tasks: Sync preflight failed (op=83 job=29): Missing required FK fields for sales.SaleItem: sale_id
[2025-11-19 21:04:24,497] INFO sync.tasks: Processed SyncJob 29: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 80, 'error': 'Missing required FK fields for purchases.PurchaseOrder: tenant_id'}, {'op_id': 81, 'error': 'Missing required FK fields for purchases.PurchaseItem: purchase_id'}, {'op_id': 82, 'error': 'Missing required FK fields for sales.Sale: tenant_id'}, {'op_id': 83, 'error': 'Missing required FK fields for sales.SaleItem: sale_id'}]}
[2025-11-19 21:04:30,659] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.07s
[2025-11-21 00:21:57,325] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=401 duration=0.00s
[2025-11-26 22:23:43,330] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=400 duration=0.04s
[2025-11-26 23:17:33,361] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=400 duration=0.09s
[2025-11-27 15:26:13,828] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.38s
[2025-11-27 15:26:14,449] WARNING sync.tasks: Sync preflight failed (op=84 job=30): Missing required FK fields for purchases.PurchaseOrder: tenant_id
[2025-11-27 15:26:14,484] WARNING sync.tasks: Sync preflight failed (op=85 job=30): Missing required FK fields for purchases.PurchaseItem: purchase_id
[2025-11-27 15:26:14,512] WARNING sync.tasks: Sync preflight failed (op=86 job=30): Missing required FK fields for sales.Sale: tenant_id
[2025-11-27 15:26:14,532] WARNING sync.tasks: Sync preflight failed (op=87 job=30): Missing required FK fields for sales.SaleItem: sale_id
[2025-11-27 15:26:14,579] INFO sync.tasks: Processed SyncJob 30: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 84, 'error': 'Missing required FK fields for purchases.PurchaseOrder: tenant_id'}, {'op_id': 85, 'error': 'Missing required FK fields for purchases.PurchaseItem: purchase_id'}, {'op_id': 86, 'error': 'Missing required FK fields for sales.Sale: tenant_id'}, {'op_id': 87, 'error': 'Missing required FK fields for sales.SaleItem: sale_id'}]}
[2025-11-27 15:26:26,934] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.03s
[2025-11-27 15:51:54,629] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.12s
[2025-11-27 15:51:54,869] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseOrder id=15 job=31 op=88
[2025-11-27 15:51:54,907] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseItem id=11 job=31 op=89
[2025-11-27 15:51:54,964] ERROR sync.tasks: Sync preflight validation error (op=90): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 233, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 165, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-11-27 15:51:55,064] ERROR sync.tasks: Error processing sync op 90: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 233, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 165, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-27 15:51:55,130] INFO sync.tasks: Sync CREATE: tenant=9 model=sales.SaleItem id=13 job=31 op=91
[2025-11-27 15:51:55,154] INFO sync.tasks: Processed SyncJob 31: {'processed': 4, 'succeeded': 3, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 90, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-11-27 15:51:59,696] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-11-27 18:33:20,116] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.25s
[2025-11-27 18:33:20,722] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseOrder id=16 job=32 op=92
[2025-11-27 18:33:20,763] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseItem id=12 job=32 op=93
[2025-11-27 18:33:20,796] ERROR sync.tasks: Sync preflight validation error (op=94): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 233, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 165, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-11-27 18:33:20,846] ERROR sync.tasks: Error processing sync op 94: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 233, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 165, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-27 18:33:20,874] INFO sync.tasks: Sync CREATE: tenant=9 model=sales.SaleItem id=14 job=32 op=95
[2025-11-27 18:33:20,905] INFO sync.tasks: Processed SyncJob 32: {'processed': 4, 'succeeded': 3, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 94, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-11-27 18:33:36,158] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-11-28 07:15:51,409] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.41s
[2025-11-28 07:15:51,704] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseOrder id=17 job=33 op=96
[2025-11-28 07:15:51,756] INFO sync.tasks: Sync CREATE: tenant=9 model=purchases.PurchaseItem id=13 job=33 op=97
[2025-11-28 07:15:51,808] ERROR sync.tasks: Sync preflight validation error (op=98): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 233, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 165, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-11-28 07:15:51,854] ERROR sync.tasks: Error processing sync op 98: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 233, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 165, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-11-28 07:15:51,923] INFO sync.tasks: Sync CREATE: tenant=9 model=sales.SaleItem id=15 job=33 op=99
[2025-11-28 07:15:51,986] INFO sync.tasks: Processed SyncJob 33: {'processed': 4, 'succeeded': 3, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 98, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-11-28 07:16:02,321] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.05s
[2025-12-10 12:48:15,525] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.90s
[2025-12-10 12:48:32,039] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.20s
[2025-12-10 12:53:55,693] WARNING sync.tasks: Sync preflight failed (op=100 job=34): Missing required FK fields for inventory.Category: tenant_id
[2025-12-10 12:53:55,708] WARNING sync.tasks: Sync preflight failed (op=101 job=34): Missing required FK fields for inventory.Product: tenant_id
[2025-12-10 12:53:55,759] ERROR sync.tasks: Sync preflight validation error (op=102): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 213, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 166, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 12:53:55,826] ERROR sync.tasks: Error processing sync op 102: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 213, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 166, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 12:53:55,852] WARNING sync.tasks: Sync preflight failed (op=103 job=34): Missing required FK fields for sales.Sale: tenant_id, created_by_id
[2025-12-10 12:53:55,885] INFO sync.tasks: Processed SyncJob 34: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 100, 'error': 'Missing required FK fields for inventory.Category: tenant_id'}, {'op_id': 101, 'error': 'Missing required FK fields for inventory.Product: tenant_id'}, {'op_id': 102, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 103, 'error': 'Missing required FK fields for sales.Sale: tenant_id, created_by_id'}]}
[2025-12-10 12:54:46,734] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.16s
[2025-12-10 13:13:32,636] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.36s
[2025-12-10 13:13:33,034] WARNING sync.tasks: Sync preflight failed (op=104 job=35): Missing required FK fields for inventory.Category: tenant_id
[2025-12-10 13:13:33,048] WARNING sync.tasks: Sync preflight failed (op=105 job=35): Missing required FK fields for inventory.Product: tenant_id
[2025-12-10 13:13:33,122] ERROR sync.tasks: Sync preflight validation error (op=106): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 213, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 166, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 13:13:33,206] ERROR sync.tasks: Error processing sync op 106: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 213, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 166, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 13:13:33,241] WARNING sync.tasks: Sync preflight failed (op=107 job=35): Missing required FK fields for sales.Sale: tenant_id, created_by_id
[2025-12-10 13:13:33,335] INFO sync.tasks: Processed SyncJob 35: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 104, 'error': 'Missing required FK fields for inventory.Category: tenant_id'}, {'op_id': 105, 'error': 'Missing required FK fields for inventory.Product: tenant_id'}, {'op_id': 106, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 107, 'error': 'Missing required FK fields for sales.Sale: tenant_id, created_by_id'}]}
[2025-12-10 13:13:43,513] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.30s
[2025-12-10 13:26:51,860] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=1.10s
[2025-12-10 13:26:52,333] INFO sync.tasks: Sync CREATE: tenant=9 model=inventory.Category id=6 job=36 op=108
[2025-12-10 13:26:52,367] WARNING sync.tasks: Sync preflight tmp resolution failed (op=109 job=36): Referenced tmp ids not found in job (create): category_tmp_id -> 1001
[2025-12-10 13:26:52,405] ERROR sync.tasks: Sync preflight validation error (op=110): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 236, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 163, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 13:26:52,525] ERROR sync.tasks: Error processing sync op 110: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 236, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 163, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 13:26:52,797] INFO sync.tasks: Sync CREATE: tenant=9 model=sales.Sale id=16 job=36 op=111
[2025-12-10 13:26:52,849] INFO sync.tasks: Processed SyncJob 36: {'processed': 4, 'succeeded': 2, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 109, 'error': 'Referenced tmp ids not found in job (create): category_tmp_id -> 1001'}, {'op_id': 110, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-12-10 13:27:07,942] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.09s
[2025-12-10 13:32:42,594] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.12s
[2025-12-10 13:32:42,907] ERROR sync.tasks: Exception while applying sync operation (job=37 op=112): Category() got unexpected keyword arguments: 'created_by_id'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 282, in _apply_sync_operation
    obj = Model.objects.create(**payload)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 569, in __init__
    raise TypeError(
TypeError: Category() got unexpected keyword arguments: 'created_by_id'
[2025-12-10 13:32:42,954] WARNING sync.tasks: Sync preflight tmp resolution failed (op=113 job=37): Referenced tmp ids not found in job (create): category_tmp_id -> 1001
[2025-12-10 13:32:43,022] ERROR sync.tasks: Sync preflight validation error (op=114): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 236, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 163, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 13:32:43,140] ERROR sync.tasks: Error processing sync op 114: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 236, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 163, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 13:32:43,227] ERROR sync.tasks: Sync preflight validation error (op=115): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 236, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 163, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 13:32:43,281] ERROR sync.tasks: Error processing sync op 115: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 236, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 163, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 13:32:43,358] INFO sync.tasks: Processed SyncJob 37: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 112, 'error': "Category() got unexpected keyword arguments: 'created_by_id'"}, {'op_id': 113, 'error': 'Referenced tmp ids not found in job (create): category_tmp_id -> 1001'}, {'op_id': 114, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 115, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-12-10 13:32:49,177] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.11s
[2025-12-10 16:41:02,672] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.41s
[2025-12-10 16:41:03,063] INFO sync.tasks: Processed SyncJob 38: {'processed': 4, 'succeeded': 1, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 116, 'error': 'duplicate key value violates unique constraint "inventory_category_tenant_id_name_85eea810_uniq"\nDETAIL:  Key (tenant_id, name)=(9, Bags) already exists.\n'}, {'op_id': 117, 'error': 'Referenced tmp ids not found in job (create): category_tmp_id -> 1001'}, {'op_id': 119, 'error': 'null value in column "created_by_id" of relation "sales_sale" violates not-null constraint\nDETAIL:  Failing row contains (17, SALE-2000, John Doe, 6000.00, cash, 2025-12-10 16:41:03.039205+00, null, null, 9).\n'}]}
[2025-12-10 16:41:17,558] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.07s
[2025-12-10 16:50:37,897] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.89s
[2025-12-10 16:50:38,498] WARNING sync.tasks: Sync preflight failed (op=120 job=39): Missing required FK fields for inventory.Category: tenant_id
[2025-12-10 16:50:38,560] WARNING sync.tasks: Sync preflight failed (op=121 job=39): Missing required FK fields for inventory.Product: tenant_id
[2025-12-10 16:50:38,879] WARNING sync.tasks: Sync preflight failed (op=123 job=39): Missing required FK fields for sales.Sale: tenant_id, created_by_id
[2025-12-10 16:50:38,974] INFO sync.tasks: Processed SyncJob 39: {'processed': 4, 'succeeded': 1, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 120, 'error': 'Missing required FK fields for inventory.Category: tenant_id'}, {'op_id': 121, 'error': 'Missing required FK fields for inventory.Product: tenant_id'}, {'op_id': 123, 'error': 'Missing required FK fields for sales.Sale: tenant_id, created_by_id'}]}
[2025-12-10 16:51:21,546] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.11s
[2025-12-10 16:51:21,969] WARNING sync.tasks: Sync preflight failed (op=124 job=40): Missing required FK fields for inventory.Category: tenant_id
[2025-12-10 16:51:21,988] WARNING sync.tasks: Sync preflight failed (op=125 job=40): Missing required FK fields for inventory.Product: tenant_id
[2025-12-10 16:51:22,047] ERROR sync.tasks: Sync preflight validation error (op=126): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 188, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 154, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 16:51:22,132] ERROR sync.tasks: Error processing sync op 126: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 188, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 154, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 16:51:22,206] ERROR sync.tasks: Sync preflight validation error (op=127): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 188, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 154, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 16:51:22,251] ERROR sync.tasks: Error processing sync op 127: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 188, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 154, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 16:51:22,353] INFO sync.tasks: Processed SyncJob 40: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 124, 'error': 'Missing required FK fields for inventory.Category: tenant_id'}, {'op_id': 125, 'error': 'Missing required FK fields for inventory.Product: tenant_id'}, {'op_id': 126, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 127, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-12-10 17:06:05,890] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=1.46s
[2025-12-10 17:06:06,373] WARNING sync.tasks: Sync preflight failed (op=128 job=41): Missing required FK fields for inventory.Category: tenant_id
[2025-12-10 17:06:06,409] WARNING sync.tasks: Sync preflight failed (op=129 job=41): Missing required FK fields for inventory.Product: tenant_id
[2025-12-10 17:06:06,508] ERROR sync.tasks: Sync preflight validation error (op=130): Object of type Tenant is not JSON serializable
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 194, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 158, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/postgresql/psycopg_any.py", line 113, in getquoted
    quoted = super().getquoted()
             ^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 78, in getquoted
    s = self.dumps(self.adapted)
        ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 72, in dumps
    return self._dumps(obj)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type Tenant is not JSON serializable
[2025-12-10 17:06:06,613] ERROR sync.tasks: Error processing sync op 130: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 194, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 158, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/postgresql/psycopg_any.py", line 113, in getquoted
    quoted = super().getquoted()
             ^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 78, in getquoted
    s = self.dumps(self.adapted)
        ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 72, in dumps
    return self._dumps(obj)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type Tenant is not JSON serializable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 17:06:06,723] ERROR sync.tasks: Sync preflight validation error (op=131): Object of type Tenant is not JSON serializable
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 194, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 158, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/postgresql/psycopg_any.py", line 113, in getquoted
    quoted = super().getquoted()
             ^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 78, in getquoted
    s = self.dumps(self.adapted)
        ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 72, in dumps
    return self._dumps(obj)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type Tenant is not JSON serializable
[2025-12-10 17:06:06,804] ERROR sync.tasks: Error processing sync op 131: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 194, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 158, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/postgresql/psycopg_any.py", line 113, in getquoted
    quoted = super().getquoted()
             ^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 78, in getquoted
    s = self.dumps(self.adapted)
        ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 72, in dumps
    return self._dumps(obj)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type Tenant is not JSON serializable

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 44, in process_sync_job
    op.mark_processed(False, result.get("error"))
  File "/home/brymar/projects/smart-inventory/backend/sync/models.py", line 129, in mark_processed
    self.save(update_fields=["processed", "processed_at", "success", "error"])
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1286, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 99, in _execute
    self.db.validate_no_broken_transaction()
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/base/base.py", line 521, in validate_no_broken_transaction
    raise TransactionManagementError(
django.db.transaction.TransactionManagementError: An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block.
[2025-12-10 17:06:06,926] INFO sync.tasks: Processed SyncJob 41: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 128, 'error': 'Missing required FK fields for inventory.Category: tenant_id'}, {'op_id': 129, 'error': 'Missing required FK fields for inventory.Product: tenant_id'}, {'op_id': 130, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}, {'op_id': 131, 'error': "An error occurred in the current transaction. You can't execute queries until the end of the 'atomic' block."}]}
[2025-12-10 17:06:32,753] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.06s
[2025-12-10 17:19:47,448] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=1.57s
[2025-12-10 17:19:47,905] ERROR sync.tasks: Exception while applying sync operation (job=42 op=134): Object of type Tenant is not JSON serializable
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 162, in _apply_sync_operation
    sync_models.ChangeLog.objects.create(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/postgresql/psycopg_any.py", line 113, in getquoted
    quoted = super().getquoted()
             ^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 78, in getquoted
    s = self.dumps(self.adapted)
        ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 72, in dumps
    return self._dumps(obj)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type Tenant is not JSON serializable
[2025-12-10 17:19:48,027] ERROR sync.tasks: Exception while applying sync operation (job=42 op=135): Object of type Tenant is not JSON serializable
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 162, in _apply_sync_operation
    sync_models.ChangeLog.objects.create(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/postgresql/psycopg_any.py", line 113, in getquoted
    quoted = super().getquoted()
             ^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 78, in getquoted
    s = self.dumps(self.adapted)
        ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/psycopg2/_json.py", line 72, in dumps
    return self._dumps(obj)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type Tenant is not JSON serializable
[2025-12-10 17:19:48,112] INFO sync.tasks: Processed SyncJob 42: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 132, 'error': 'Missing required FK fields for inventory.Category: tenant_id'}, {'op_id': 133, 'error': 'Missing required FK fields for inventory.Product: tenant_id'}, {'op_id': 134, 'error': 'Object of type Tenant is not JSON serializable'}, {'op_id': 135, 'error': 'Object of type Tenant is not JSON serializable'}]}
[2025-12-10 17:20:14,618] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.08s
[2025-12-10 17:30:26,162] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.61s
[2025-12-10 17:30:26,591] WARNING sync.tasks: IntegrityError processing op 136: duplicate key value violates unique constraint "inventory_category_tenant_id_name_85eea810_uniq"
DETAIL:  Key (tenant_id, name)=(9, Bags) already exists.

[2025-12-10 17:30:26,634] ERROR sync.tasks: Exception while applying sync operation (job=43 op=137): Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 218, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(obj, "id", None), "create", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 161, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 545, in __init__
    _setattr(self, field.name, rel_obj)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/fields/related_descriptors.py", line 291, in __set__
    raise ValueError(
ValueError: Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.
[2025-12-10 17:30:26,748] ERROR sync.tasks: Sync preflight validation error (op=138): Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 190, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 161, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 545, in __init__
    _setattr(self, field.name, rel_obj)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/fields/related_descriptors.py", line 291, in __set__
    raise ValueError(
ValueError: Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.
[2025-12-10 17:30:26,839] ERROR sync.tasks: Sync preflight validation error (op=139): Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 190, in _apply_sync_operation
    cl = create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 161, in create_changelog
    cl = sync_models.ChangeLog.objects.create(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 661, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 545, in __init__
    _setattr(self, field.name, rel_obj)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/fields/related_descriptors.py", line 291, in __set__
    raise ValueError(
ValueError: Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.
[2025-12-10 17:30:26,925] INFO sync.tasks: Processed SyncJob 43: {'processed': 4, 'succeeded': 0, 'failed': 4, 'conflicts': 0, 'errors': [{'op_id': 136, 'error': 'duplicate key value violates unique constraint "inventory_category_tenant_id_name_85eea810_uniq"\nDETAIL:  Key (tenant_id, name)=(9, Bags) already exists.\n'}, {'op_id': 137, 'error': 'Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.'}, {'op_id': 138, 'error': 'Preflight validation failed: Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.'}, {'op_id': 139, 'error': 'Preflight validation failed: Cannot assign "9": "ChangeLog.tenant" must be a "Tenant" instance.'}]}
[2025-12-10 17:31:03,755] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.06s
[2025-12-10 17:51:58,774] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.64s
[2025-12-10 17:51:59,218] WARNING sync.tasks: IntegrityError processing op 140: duplicate key value violates unique constraint "inventory_category_tenant_id_name_85eea810_uniq"
DETAIL:  Key (tenant_id, name)=(9, Bags) already exists.

[2025-12-10 17:51:59,344] ERROR sync.tasks: Sync preflight validation error (op=142): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 206, in _apply_sync_operation
    create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 173, in create_changelog
    return sync_models.ChangeLog.objects.create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 17:51:59,453] ERROR sync.tasks: Sync preflight validation error (op=143): value too long for type character varying(16)
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(16)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 206, in _apply_sync_operation
    create_changelog(model_path, getattr(existing, "id", None), "noop_map_existing", payload)
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 173, in create_changelog
    return sync_models.ChangeLog.objects.create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/home/brymar/projects/smart-inventory/backend/venv/lib/python3.12/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.DataError: value too long for type character varying(16)

[2025-12-10 17:51:59,527] INFO sync.tasks: Processed SyncJob 44: {'processed': 4, 'succeeded': 1, 'failed': 3, 'conflicts': 0, 'errors': [{'op_id': 140, 'error': 'duplicate key value violates unique constraint "inventory_category_tenant_id_name_85eea810_uniq"\nDETAIL:  Key (tenant_id, name)=(9, Bags) already exists.\n'}, {'op_id': 142, 'error': 'Preflight validation failed: value too long for type character varying(16)\n'}, {'op_id': 143, 'error': 'Preflight validation failed: value too long for type character varying(16)\n'}]}
[2025-12-10 17:52:32,254] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.11s
[2025-12-12 00:06:13,070] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=1 ip=127.0.0.1 status=400 duration=0.01s
[2025-12-12 00:06:55,305] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.08s
[2025-12-12 00:10:36,878] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=1 ip=127.0.0.1 status=400 duration=0.05s
[2025-12-12 00:10:49,529] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.05s
[2025-12-12 00:14:54,349] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=1 ip=127.0.0.1 status=400 duration=0.01s
[2025-12-12 00:30:52,345] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=1 ip=127.0.0.1 status=400 duration=0.02s
[2025-12-12 10:06:10,853] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=N/A ip=127.0.0.1 status=400 duration=0.01s
[2025-12-12 10:10:41,927] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=500 duration=0.45s
[2025-12-12 10:17:45,218] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.50s
[2025-12-12 10:17:45,360] ERROR sync.tasks: Error processing sync op 145: module 'inventory.models' has no attribute 'CharField'
Traceback (most recent call last):
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 46, in process_sync_job
    result = _apply_sync_operation(job, op)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brymar/projects/smart-inventory/backend/sync/tasks.py", line 157, in _apply_sync_operation
    if isinstance(f, models.CharField) and f.max_length:
                     ^^^^^^^^^^^^^^^^
AttributeError: module 'inventory.models' has no attribute 'CharField'
[2025-12-12 10:17:45,371] INFO sync.tasks: Processed SyncJob 45: {'processed': 2, 'succeeded': 0, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 144, 'error': "pending_fk: waiting for tmp_ids [('category_id', 'tmp-cat-1')]"}, {'op_id': 145, 'error': "module 'inventory.models' has no attribute 'CharField'"}]}
[2025-12-12 10:17:56,203] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.08s
[2025-12-12 10:26:17,784] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.30s
[2025-12-12 10:26:18,145] INFO sync.tasks: Processed SyncJob 46: {'processed': 2, 'succeeded': 1, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 147, 'error': "pending_fk: waiting for tmp_ids [('category_id', 'tmp-cat-1')]"}]}
[2025-12-12 10:26:27,208] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.05s
[2025-12-12 10:32:17,417] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.71s
[2025-12-12 10:32:17,827] INFO sync.tasks: Processed SyncJob 47: {'processed': 2, 'succeeded': 0, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 148, 'error': 'IntegrityError: duplicate key value violates unique constraint "inventory_category_tenant_id_name_85eea810_uniq"\nDETAIL:  Key (tenant_id, name)=(9, Electronics) already exists.\n'}, {'op_id': 149, 'error': "pending_fk: waiting for tmp_ids [('category_id', 'tmp-cat-1')]"}]}
[2025-12-12 10:32:28,951] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.13s
[2025-12-12 10:33:03,089] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.05s
[2025-12-12 10:33:03,223] INFO sync.tasks: Processed SyncJob 48: {'processed': 2, 'succeeded': 1, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 151, 'error': "pending_fk: waiting for tmp_ids [('category_id', 'tmp-cat-1')]"}]}
[2025-12-12 10:33:10,385] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-12-12 10:59:49,237] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.37s
[2025-12-12 10:59:49,473] INFO sync.tasks: Processed SyncJob 49: {'processed': 2, 'succeeded': 0, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 152, 'error': 'IntegrityError: duplicate key value violates unique constraint "inventory_product_tenant_id_sku_547f9936_uniq"\nDETAIL:  Key (tenant_id, sku)=(9, ) already exists.\n'}, {'op_id': 153, 'error': 'IntegrityError: duplicate key value violates unique constraint "inventory_category_tenant_id_name_85eea810_uniq"\nDETAIL:  Key (tenant_id, name)=(9, Electronics) already exists.\n'}]}
[2025-12-12 10:59:59,930] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.04s
[2025-12-12 11:24:30,793] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.06s
[2025-12-12 11:24:30,965] INFO sync.tasks: Processed SyncJob 50: {'processed': 2, 'succeeded': 2, 'failed': 0, 'conflicts': 0, 'errors': []}
[2025-12-12 11:24:41,789] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.10s
[2025-12-13 00:23:23,760] INFO sync: [SYNC] POST /api/sync/upload/ by 'Admin' device=test-device-001 ip=127.0.0.1 status=202 duration=0.80s
[2025-12-13 00:23:25,154] INFO sync.tasks: Processed SyncJob 51: {'processed': 2, 'succeeded': 0, 'failed': 2, 'conflicts': 0, 'errors': [{'op_id': 156, 'error': 'IntegrityError: duplicate key value violates unique constraint "inventory_category_tenant_id_name_85eea810_uniq"\nDETAIL:  Key (tenant_id, name)=(9, Electronics) already exists.\n'}, {'op_id': 157, 'error': 'IntegrityError: duplicate key value violates unique constraint "inventory_product_tenant_id_sku_547f9936_uniq"\nDETAIL:  Key (tenant_id, sku)=(9, ) already exists.\n'}]}
[2025-12-13 00:23:30,923] INFO sync: [SYNC] GET /api/sync/jobs/ by 'Admin' device=N/A ip=127.0.0.1 status=200 duration=0.26s
[2025-12-24 17:04:36,454] INFO sync.tasks:  Sync failure notification sent for job 2
[2025-12-24 17:04:36,457] INFO sync.tasks: Processed SyncJob 2: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 2, 'error': "Product() got unexpected keyword arguments: 'unit_cost'"}]}
[2025-12-24 17:17:05,455] INFO sync.tasks: Processed SyncJob 2: {'processed': 1, 'succeeded': 1, 'failed': 0, 'conflicts': 0, 'errors': []}
[2025-12-24 17:41:23,924] INFO sync.tasks:  Sync failure notification sent for job 3
[2025-12-24 17:41:23,925] INFO sync.tasks: Processed SyncJob 3: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 0, 'errors': [{'op_id': 4, 'error': 'IntegrityError: duplicate key value violates unique constraint "inventory_product_tenant_id_sku_547f9936_uniq"\nDETAIL:  Key (tenant_id, sku)=(1, CONFLICT-001) already exists.\n'}]}
[2025-12-24 18:26:09,464] INFO sync.tasks:  Sync failure notification sent for job 4
[2025-12-24 18:26:09,471] INFO sync.tasks:  Sync conflict notification sent for job 4 (1 conflicts)
[2025-12-24 18:26:09,471] INFO sync.tasks: Processed SyncJob 4: {'processed': 1, 'succeeded': 0, 'failed': 1, 'conflicts': 1, 'errors': [{'op_id': 5, 'error': 'duplicate key value violates unique constraint "inventory_product_tenant_id_sku_547f9936_uniq"\nDETAIL:  Key (tenant_id, sku)=(1, CONFLICT-001) already exists.\n'}]}
